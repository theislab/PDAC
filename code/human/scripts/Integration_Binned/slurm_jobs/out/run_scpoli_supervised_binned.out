Starting supervised integration with scPoli...
Filtered AnnData shape: (726054, 2505)
Setting up scPoli model for supervised training...
Embedding dictionary:
 	Num conditions: [173]
 	Embedding dim: [10]
Encoder Architecture:
	Input Layer in, out and cond: 2505 51 10
	Mean/Var Layer in/out: 51 10
Decoder Architecture:
	First Layer in, out and cond:  10 51 10
	Output Layer in/out:  51 2505 

Training the scPoli model...
Initializing dataloaders
Starting training
 |--------------------| 1.0%  - val_loss: 4124.01 - val_cvae_loss: 4124.01 |--------------------| 2.0%  - val_loss: 4103.33 - val_cvae_loss: 4103.33 |--------------------| 3.0%  - val_loss: 4099.22 - val_cvae_loss: 4099.22 |--------------------| 4.0%  - val_loss: 4097.24 - val_cvae_loss: 4097.24 |█-------------------| 5.0%  - val_loss: 4095.60 - val_cvae_loss: 4095.60 |█-------------------| 6.0%  - val_loss: 4094.93 - val_cvae_loss: 4094.93 |█-------------------| 7.0%  - val_loss: 4095.41 - val_cvae_loss: 4095.41 |█-------------------| 8.0%  - val_loss: 4093.90 - val_cvae_loss: 4093.90 |█-------------------| 9.0%  - val_loss: 4093.58 - val_cvae_loss: 4093.58 |██------------------| 10.0%  - val_loss: 4093.17 - val_cvae_loss: 4093.17 |██------------------| 11.0%  - val_loss: 4093.18 - val_cvae_loss: 4093.18 |██------------------| 12.0%  - val_loss: 4094.13 - val_cvae_loss: 4094.13 |██------------------| 13.0%  - val_loss: 4093.36 - val_cvae_loss: 4093.36 |██------------------| 14.0%  - val_loss: 4092.92 - val_cvae_loss: 4092.92 |███-----------------| 15.0%  - val_loss: 4093.80 - val_cvae_loss: 4093.80 |███-----------------| 16.0%  - val_loss: 4093.68 - val_cvae_loss: 4093.68 |███-----------------| 17.0%  - val_loss: 4094.02 - val_cvae_loss: 4094.02 |███-----------------| 18.0%  - val_loss: 4093.96 - val_cvae_loss: 4093.96 |███-----------------| 19.0%  - val_loss: 4093.92 - val_cvae_loss: 4093.92 |████----------------| 20.0%  - val_loss: 4095.04 - val_cvae_loss: 4095.04 |████----------------| 21.0%  - val_loss: 4093.94 - val_cvae_loss: 4093.94 |████----------------| 22.0%  - val_loss: 4094.00 - val_cvae_loss: 4094.00 |████----------------| 23.0%  - val_loss: 4095.73 - val_cvae_loss: 4095.73 |████----------------| 24.0%  - val_loss: 4094.84 - val_cvae_loss: 4094.84 |█████---------------| 25.0%  - val_loss: 4095.50 - val_cvae_loss: 4095.50 |█████---------------| 26.0%  - val_loss: 4095.70 - val_cvae_loss: 4095.70 |█████---------------| 27.0%  - val_loss: 4095.72 - val_cvae_loss: 4095.72 |█████---------------| 28.0%  - val_loss: 4095.61 - val_cvae_loss: 4095.61 |█████---------------| 29.0%  - val_loss: 4096.97 - val_cvae_loss: 4096.97 |██████--------------| 30.0%  - val_loss: 4095.47 - val_cvae_loss: 4095.47 |██████--------------| 31.0%  - val_loss: 4096.31 - val_cvae_loss: 4096.31 |██████--------------| 32.0%  - val_loss: 4097.93 - val_cvae_loss: 4097.93 |██████--------------| 33.0%  - val_loss: 4098.37 - val_cvae_loss: 4098.37 |██████--------------| 34.0%  - val_loss: 4098.67 - val_cvae_loss: 4098.67 |███████-------------| 35.0%  - val_loss: 4097.13 - val_cvae_loss: 4097.13 |███████-------------| 36.0%  - val_loss: 4098.11 - val_cvae_loss: 4098.11 |███████-------------| 37.0%  - val_loss: 4098.58 - val_cvae_loss: 4098.58 |███████-------------| 38.0%  - val_loss: 4099.64 - val_cvae_loss: 4099.64 |███████-------------| 39.0%  - val_loss: 4098.61 - val_cvae_loss: 4098.61 |████████------------| 40.0%  - val_loss: 4100.15 - val_cvae_loss: 4100.15 |████████------------| 41.0%  - val_loss: 4170.41 - val_cvae_loss: 4112.30 - val_prototype_loss:   58.11 - val_labeled_loss:   11.62 |████████------------| 42.0%  - val_loss: 4159.61 - val_cvae_loss: 4113.45 - val_prototype_loss:   46.16 - val_labeled_loss:    9.23 |████████------------| 43.0%  - val_loss: 4151.23 - val_cvae_loss: 4113.63 - val_prototype_loss:   37.60 - val_labeled_loss:    7.52 |████████------------| 44.0%  - val_loss: 4145.95 - val_cvae_loss: 4114.54 - val_prototype_loss:   31.41 - val_labeled_loss:    6.28 |█████████-----------| 45.0%  - val_loss: 4139.39 - val_cvae_loss: 4112.59 - val_prototype_loss:   26.79 - val_labeled_loss:    5.36 |█████████-----------| 46.0%  - val_loss: 4136.32 - val_cvae_loss: 4112.70 - val_prototype_loss:   23.63 - val_labeled_loss:    4.73 |█████████-----------| 47.0%  - val_loss: 4133.79 - val_cvae_loss: 4112.61 - val_prototype_loss:   21.17 - val_labeled_loss:    4.23 |█████████-----------| 48.0%  - val_loss: 4134.26 - val_cvae_loss: 4115.08 - val_prototype_loss:   19.18 - val_labeled_loss:    3.84 |█████████-----------| 49.0%  - val_loss: 4131.42 - val_cvae_loss: 4113.53 - val_prototype_loss:   17.89 - val_labeled_loss:    3.58 |██████████----------| 50.0%  - val_loss: 4130.56 - val_cvae_loss: 4113.58 - val_prototype_loss:   16.98 - val_labeled_loss:    3.40 |██████████----------| 51.0%  - val_loss: 4130.48 - val_cvae_loss: 4114.53 - val_prototype_loss:   15.95 - val_labeled_loss:    3.19 |██████████----------| 52.0%  - val_loss: 4130.33 - val_cvae_loss: 4115.15 - val_prototype_loss:   15.18 - val_labeled_loss:    3.04 |██████████----------| 53.0%  - val_loss: 4130.37 - val_cvae_loss: 4116.10 - val_prototype_loss:   14.27 - val_labeled_loss:    2.85 |██████████----------| 54.0%  - val_loss: 4130.68 - val_cvae_loss: 4116.45 - val_prototype_loss:   14.23 - val_labeled_loss:    2.85 |███████████---------| 55.0%  - val_loss: 4130.88 - val_cvae_loss: 4117.13 - val_prototype_loss:   13.75 - val_labeled_loss:    2.75 |███████████---------| 56.0%  - val_loss: 4131.14 - val_cvae_loss: 4117.82 - val_prototype_loss:   13.32 - val_labeled_loss:    2.66 |███████████---------| 57.0%  - val_loss: 4132.14 - val_cvae_loss: 4119.04 - val_prototype_loss:   13.10 - val_labeled_loss:    2.62 |███████████---------| 58.0%  - val_loss: 4134.23 - val_cvae_loss: 4121.24 - val_prototype_loss:   12.98 - val_labeled_loss:    2.60 |███████████---------| 59.0%  - val_loss: 4132.12 - val_cvae_loss: 4119.22 - val_prototype_loss:   12.90 - val_labeled_loss:    2.58 |████████████--------| 60.0%  - val_loss: 4132.17 - val_cvae_loss: 4119.29 - val_prototype_loss:   12.88 - val_labeled_loss:    2.58 |████████████--------| 61.0%  - val_loss: 4133.14 - val_cvae_loss: 4120.50 - val_prototype_loss:   12.64 - val_labeled_loss:    2.53 |████████████--------| 62.0%  - val_loss: 4133.69 - val_cvae_loss: 4120.83 - val_prototype_loss:   12.86 - val_labeled_loss:    2.57 |████████████--------| 63.0%  - val_loss: 4133.30 - val_cvae_loss: 4120.50 - val_prototype_loss:   12.81 - val_labeled_loss:    2.56 |████████████--------| 64.0%  - val_loss: 4134.16 - val_cvae_loss: 4121.48 - val_prototype_loss:   12.69 - val_labeled_loss:    2.54 |█████████████-------| 65.0%  - val_loss: 4134.99 - val_cvae_loss: 4122.37 - val_prototype_loss:   12.63 - val_labeled_loss:    2.53 |█████████████-------| 66.0%  - val_loss: 4133.97 - val_cvae_loss: 4121.15 - val_prototype_loss:   12.81 - val_labeled_loss:    2.56 |█████████████-------| 67.0%  - val_loss: 4137.22 - val_cvae_loss: 4124.64 - val_prototype_loss:   12.58 - val_labeled_loss:    2.52 |█████████████-------| 68.0%  - val_loss: 4136.59 - val_cvae_loss: 4123.85 - val_prototype_loss:   12.75 - val_labeled_loss:    2.55 |█████████████-------| 69.0%  - val_loss: 4137.02 - val_cvae_loss: 4124.33 - val_prototype_loss:   12.69 - val_labeled_loss:    2.54 |██████████████------| 70.0%  - val_loss: 4136.67 - val_cvae_loss: 4123.86 - val_prototype_loss:   12.81 - val_labeled_loss:    2.56 |██████████████------| 71.0%  - val_loss: 4137.38 - val_cvae_loss: 4124.61 - val_prototype_loss:   12.77 - val_labeled_loss:    2.55 |██████████████------| 72.0%  - val_loss: 4139.17 - val_cvae_loss: 4126.37 - val_prototype_loss:   12.79 - val_labeled_loss:    2.56 |██████████████------| 73.0%  - val_loss: 4137.95 - val_cvae_loss: 4125.06 - val_prototype_loss:   12.89 - val_labeled_loss:    2.58 |██████████████------| 74.0%  - val_loss: 4137.87 - val_cvae_loss: 4125.15 - val_prototype_loss:   12.72 - val_labeled_loss:    2.54 |███████████████-----| 75.0%  - val_loss: 4139.07 - val_cvae_loss: 4126.39 - val_prototype_loss:   12.68 - val_labeled_loss:    2.54 |███████████████-----| 76.0%  - val_loss: 4138.06 - val_cvae_loss: 4125.43 - val_prototype_loss:   12.63 - val_labeled_loss:    2.53 |███████████████-----| 77.0%  - val_loss: 4139.87 - val_cvae_loss: 4127.09 - val_prototype_loss:   12.79 - val_labeled_loss:    2.56 |███████████████-----| 78.0%  - val_loss: 4141.29 - val_cvae_loss: 4128.67 - val_prototype_loss:   12.61 - val_labeled_loss:    2.52 |███████████████-----| 79.0%  - val_loss: 4141.90 - val_cvae_loss: 4129.29 - val_prototype_loss:   12.61 - val_labeled_loss:    2.52 |████████████████----| 80.0%  - val_loss: 4140.18 - val_cvae_loss: 4127.51 - val_prototype_loss:   12.67 - val_labeled_loss:    2.53 |████████████████----| 81.0%  - val_loss: 4140.80 - val_cvae_loss: 4128.19 - val_prototype_loss:   12.61 - val_labeled_loss:    2.52
ADJUSTED LR
 |████████████████----| 82.0%  - val_loss: 4133.02 - val_cvae_loss: 4120.94 - val_prototype_loss:   12.07 - val_labeled_loss:    2.41 |████████████████----| 83.0%  - val_loss: 4132.54 - val_cvae_loss: 4120.66 - val_prototype_loss:   11.89 - val_labeled_loss:    2.38 |████████████████----| 84.0%  - val_loss: 4132.43 - val_cvae_loss: 4120.64 - val_prototype_loss:   11.79 - val_labeled_loss:    2.36 |█████████████████---| 85.0%  - val_loss: 4132.57 - val_cvae_loss: 4120.79 - val_prototype_loss:   11.79 - val_labeled_loss:    2.36 |█████████████████---| 86.0%  - val_loss: 4133.25 - val_cvae_loss: 4121.46 - val_prototype_loss:   11.79 - val_labeled_loss:    2.36 |█████████████████---| 87.0%  - val_loss: 4133.60 - val_cvae_loss: 4121.85 - val_prototype_loss:   11.75 - val_labeled_loss:    2.35 |█████████████████---| 88.0%  - val_loss: 4133.59 - val_cvae_loss: 4121.85 - val_prototype_loss:   11.74 - val_labeled_loss:    2.35 |█████████████████---| 89.0%  - val_loss: 4134.02 - val_cvae_loss: 4122.27 - val_prototype_loss:   11.76 - val_labeled_loss:    2.35 |██████████████████--| 90.0%  - val_loss: 4133.82 - val_cvae_loss: 4122.05 - val_prototype_loss:   11.77 - val_labeled_loss:    2.35 |██████████████████--| 91.0%  - val_loss: 4133.87 - val_cvae_loss: 4122.00 - val_prototype_loss:   11.88 - val_labeled_loss:    2.38 |██████████████████--| 92.0%  - val_loss: 4135.34 - val_cvae_loss: 4123.43 - val_prototype_loss:   11.91 - val_labeled_loss:    2.38 |██████████████████--| 93.0%  - val_loss: 4135.02 - val_cvae_loss: 4123.23 - val_prototype_loss:   11.79 - val_labeled_loss:    2.36 |██████████████████--| 94.0%  - val_loss: 4135.49 - val_cvae_loss: 4123.67 - val_prototype_loss:   11.82 - val_labeled_loss:    2.36 |███████████████████-| 95.0%  - val_loss: 4136.70 - val_cvae_loss: 4124.98 - val_prototype_loss:   11.72 - val_labeled_loss:    2.34 |███████████████████-| 96.0%  - val_loss: 4136.04 - val_cvae_loss: 4124.28 - val_prototype_loss:   11.75 - val_labeled_loss:    2.35 |███████████████████-| 97.0%  - val_loss: 4137.39 - val_cvae_loss: 4125.64 - val_prototype_loss:   11.75 - val_labeled_loss:    2.35 |███████████████████-| 98.0%  - val_loss: 4136.98 - val_cvae_loss: 4125.15 - val_prototype_loss:   11.83 - val_labeled_loss:    2.37 |███████████████████-| 99.0%  - val_loss: 4137.50 - val_cvae_loss: 4125.66 - val_prototype_loss:   11.84 - val_labeled_loss:    2.37 |████████████████████| 100.0%  - val_loss: 4138.18 - val_cvae_loss: 4126.28 - val_prototype_loss:   11.90 - val_labeled_loss:    2.38
Extracting latent representation...
Running neighbors, Leiden clustering, and UMAP...
Supervised training completed successfully.
Saving latent space and model...
Data and model saved successfully.
